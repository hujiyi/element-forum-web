(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ddabedf8"],{"7ba5":function(e,t,a){},"91bf":function(e,t,a){"use strict";a("7ba5")},c6a6:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-card",{attrs:{shadow:"always"}},[a("div",{staticClass:"horiz-container vertical-center",attrs:{slot:"header"},slot:"header"},[a("span",{staticClass:"header-text"},[e._v("论坛版块管理")]),a("el-divider",{staticClass:"header-text",attrs:{direction:"vertical"}}),a("el-button",{attrs:{type:"danger",disabled:e.selected.length<=0},on:{click:e.deleteSelected}},[e._v("批量删除")]),a("el-button",{attrs:{type:"primary",disabled:e.selected.length<=0},on:{click:e.resetSelectedLevel}},[e._v("重置选中的排序值")]),a("div",{staticClass:"spacer"}),a("el-button",{attrs:{size:"medium",type:"success"},on:{click:function(t){e.dialog=!0}}},[a("i",{staticClass:"fa fa-plus"}),e._v(" 添加新版块 ")])],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.categories,stripe:"",border:""},on:{"selection-change":e.mutilSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"35",align:"center"}}),a("el-table-column",{attrs:{prop:"title",label:"标题"}}),a("el-table-column",{attrs:{prop:"description",label:"描述"}}),a("el-table-column",{attrs:{prop:"topicCount",label:"话题数量",width:"85"}}),a("el-table-column",{attrs:{prop:"level",label:"排序值",width:"80"}}),a("el-table-column",{attrs:{label:"最后修改",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.lastEditor.username))]),a("br"),a("span",[e._v(e._s(e._f("datetimeFormat")(t.row.updatedAt)))])]}}])}),a("el-table-column",{attrs:{label:"操作",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"medium",title:"编辑"},on:{click:function(a){return e.editItem(t.row)}}},[a("i",{staticClass:"fa fa-pencil-square-o fa-lg",staticStyle:{color:"blue"}})]),a("el-button",{attrs:{size:"medium",type:"text",title:"删除"},on:{click:function(a){return e.deleteItem(t.row)}}},[a("i",{staticClass:"fa fa-trash-o fa-lg",staticStyle:{color:"red"}})])]}}])})],1),a("el-pagination",{attrs:{background:"",layout:"total, sizes, prev, pager, next, jumper",total:e.totalCount,"page-sizes":[5,10,20,30],"page-size":e.pageSize,"current-page":e.currentPage},on:{"size-change":e.pageSizeChange,"current-change":e.currnetPageChange,"update:pageSize":function(t){e.pageSize=t},"update:page-size":function(t){e.pageSize=t},"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t}}})],1),a("el-dialog",{attrs:{visible:e.dialog,width:"80%","close-on-click-modal":!1,fullscreen:e.fullscreen},on:{"update:visible":function(t){e.dialog=t}}},[a("span",{attrs:{slot:"title"},slot:"title"},[e.fullscreen?a("el-button",{attrs:{type:"text"},on:{click:function(t){e.fullscreen=!1}}},[a("i",{staticClass:"fa fa-clone",staticStyle:{"font-size":"20px"},attrs:{title:"还原"}})]):a("el-button",{attrs:{type:"text"},on:{click:function(t){e.fullscreen=!0}}},[a("i",{staticClass:"fa fa-square-o",staticStyle:{"font-size":"20px"},attrs:{title:"最大化"}})]),a("span",{staticClass:"dialog-title"},[e._v(e._s(e.formTitle))])],1),a("el-card",{attrs:{shadow:"always"}},[a("el-form",{attrs:{"label-position":"top"}},[a("el-row",{attrs:{gutter:20}},[-1!==e.editedIndex?a("el-col",{attrs:{md:24-e.formCols,sm:24}},[a("el-form-item",{attrs:{label:"Level"}},[a("el-input",{attrs:{type:"number","controls-position":"right",max:1e3,label:"Level"},model:{value:e.editedItem.level,callback:function(t){e.$set(e.editedItem,"level",t)},expression:"editedItem.level"}})],1)],1):e._e(),a("el-col",{attrs:{md:e.formCols,sm:24}},[a("el-form-item",{attrs:{label:"标题"}},[a("el-input",{attrs:{placeholder:"标题",maxlength:"50","show-word-limit":""},model:{value:e.editedItem.title,callback:function(t){e.$set(e.editedItem,"title",t)},expression:"editedItem.title"}})],1)],1)],1),a("el-form-item",{attrs:{label:"描述(支持 Markdown 语法)"}},[a("el-input",{attrs:{type:"textarea",rows:e.row,placeholder:"版块描述"},model:{value:e.editedItem.description,callback:function(t){e.$set(e.editedItem,"description",t)},expression:"editedItem.description"}})],1)],1)],1),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"danger"},on:{click:function(t){e.dialog=!1}}},[e._v("取消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.saveItem}},[e._v("保存")])],1)],1)],1)},s=[],i=a("b85c"),r=a("1da1"),l=(a("96cf"),a("d81d"),a("498a"),a("a4d3"),a("e01a"),a("a9e3"),a("4e82"),a("a434"),a("89d5")),c=(a("c1df"),{name:"CategoryManager",data:function(){return{categories:[],totalCount:0,pageSize:10,currentPage:1,dialog:!1,fullscreen:!1,loading:!1,selected:[],editedIndex:-1,editedItem:{title:"",description:"",level:0},defaultItem:{title:"",description:"",level:0}}},mounted:function(){this.getCategories()},methods:{getCategories:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var a,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,e.categories=[],a=e.pageSize*(e.currentPage-1),t.next=5,l["a"].fetchAll(e.pageSize,a,["createdBy","lastEditor"],["-level","-createdAt"]);case 5:n=t.sent,"ok"===n.status_code&&(e.totalCount=n.totalCount,e.categories=n.reslut.map((function(t){return e.formJson(t)}))),e.loading=!1;case 8:case"end":return t.stop()}}),t)})))()},editItem:function(e){this.editedIndex=this.categories.indexOf(e),this.editedItem=Object.assign({},e),this.dialog=!0},saveItem:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var a,n,s,i,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(console.log("this.editedIndex:",e.editedIndex),-1!==e.editedIndex){t.next=29;break}return t.t0=e.editedItem.title.trim(),t.t1=e.editedItem.description,t.next=6,l["a"].currentUser();case 6:return t.t2=t.sent,t.next=9,l["a"].currentUser();case 9:if(t.t3=t.sent,a={title:t.t0,description:t.t1,level:0,topicCount:0,createdBy:t.t2,lastEditor:t.t3},!a.title){t.next=26;break}return t.next=14,l["a"].existsFieldValue("title",a.title);case 14:if(n=t.sent,!n){t.next=19;break}e.$message({message:'"'.concat(a.title,'" 版块已经存在，不能重复添加'),type:"error"}),t.next=24;break;case 19:return t.next=21,l["a"].create(a);case 21:s=t.sent,console.log("response:",s),s&&(e.categories.push(e.formJson(s)),e.editedItem=Object.assign({},e.defaultItem),e.dialog=!1,e.$notify.success({title:"添加成功",message:"已经成功添加论坛版块: ".concat(a.title),showClose:!1}));case 24:t.next=27;break;case 26:e.$message({message:"版块标题不能为空",type:"warning"});case 27:t.next=43;break;case 29:return i=Object.assign(e.categories[e.editedIndex],e.editedItem),t.t4=l["a"],t.t5=i.id,t.t6=i.title,t.t7=i.description,t.t8=Number(i.level),t.next=37,l["a"].currentUser();case 37:return t.t9=t.sent,t.t10={title:t.t6,description:t.t7,level:t.t8,lastEditor:t.t9},t.next=41,t.t4.update.call(t.t4,t.t5,t.t10);case 41:r=t.sent,r?(e.categories[e.editedIndex].updatedAt=r.updatedAt,e.categories.sort((function(e,t){return t.level-e.level})),e.dialog=!1,e.$message({message:"论坛版块编辑成功",type:"success"})):e.$message({message:"出现错误, 无法完成论坛版块修改",type:"error"});case 43:case"end":return t.stop()}}),t)})))()},deleteItem:function(e){var t=this;this.editedIndex=this.categories.indexOf(e),this.editedItem=Object.assign({},e),this.$confirm('确定要删除名为："'.concat(e.title,'" 的版块吗？'),"删除版块",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(r["a"])(regeneratorRuntime.mark((function a(){var n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,l["a"].delete(e.id);case 2:n=a.sent,n&&(t.categories.splice(t.editedIndex,1)[0],t.$message({type:"success",message:"删除成功!"}));case 4:case"end":return a.stop()}}),a)})))).catch((function(){t.$message({type:"info",message:"已取消删除"})}))},mutilSelectionChange:function(e){this.selected=e,console.log(this.selected)},deleteSelected:function(){var e=this;this.$confirm("确定要删除已选中的 ".concat(this.selected.length," 个版块吗？"),"批量删除版块",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(r["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,l["a"].deleteBatch(e.selected);case 2:a=t.sent,a&&(e.getCategories(),e.selected=[],e.$message({type:"success",message:"删除成功!"}));case 4:case"end":return t.stop()}}),t)})))).catch((function(){e.$message({type:"info",message:"已取消删除"})}))},resetSelectedLevel:function(){var e=this,t=[];this.$confirm("确定要将已选中的 ".concat(this.selected.length," 个版块的 Level 值重置为 0 吗？"),"重置Level值",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(r["a"])(regeneratorRuntime.mark((function a(){var n,s,r,c;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:n=Object(i["a"])(e.selected),a.prev=1,n.s();case 3:if((s=n.n()).done){a.next=15;break}return r=s.value,console.log(r),a.t0=t,a.t1=r.id,a.next=10,l["a"].currentUser();case 10:a.t2=a.sent,a.t3={id:a.t1,level:0,lastEditor:a.t2},a.t0.push.call(a.t0,a.t3);case 13:a.next=3;break;case 15:a.next=20;break;case 17:a.prev=17,a.t4=a["catch"](1),n.e(a.t4);case 20:return a.prev=20,n.f(),a.finish(20);case 23:return a.next=25,l["a"].updateBatch(t);case 25:c=a.sent,c&&(e.getCategories(),e.selected=[],e.$message({type:"success",message:"重置成功!"}));case 27:case"end":return a.stop()}}),a,null,[[1,17,20,23]])})))).catch((function(t){console.log("出现异常:",t),e.$message({type:"info",message:"已取消重置操作"})}))},closeDialog:function(){var e=this;this.dialog=!1,this.fullscreen=!1,this.$nextTick((function(){e.editedItem=Object.assign({},e.defaultItem),e.editedIndex=-1}))},pageSizeChange:function(e){this.getCategories()},currnetPageChange:function(e){this.getCategories()},getUser:function(e){return{id:e.id,username:e.get("username"),email:e.get("email")}},formJson:function(e){return{id:e.id,title:e.get("title"),description:e.get("description"),level:e.get("level"),topicCount:e.get("topicCount"),createdAt:e.createdAt,updatedAt:e.updatedAt,createdBy:e.get("createdBy")?this.getUser(e.get("createdBy")):"",lastEditor:e.get("lastEditor")?this.getUser(e.get("lastEditor")):""}}},computed:{formTitle:function(){return-1===this.editedIndex?"添加新版块":"版块编辑"},formCols:function(){return-1===this.editedIndex?24:21},row:function(){return this.fullscreen?15:5}},watch:{dialog:function(e){e||this.closeDialog()}}}),o=c,d=(a("91bf"),a("2877")),u=Object(d["a"])(o,n,s,!1,null,null,null);t["default"]=u.exports}}]);
//# sourceMappingURL=chunk-ddabedf8.6f2a237c.js.map