(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7bee715a"],{"04d1":function(e,t,n){var r=n("342f"),a=r.match(/firefox\/(\d+)/i);e.exports=!!a&&+a[1]},"159b":function(e,t,n){var r=n("da84"),a=n("fdbc"),i=n("785a"),s=n("17c2"),o=n("9112"),c=function(e){if(e&&e.forEach!==s)try{o(e,"forEach",s)}catch(t){e.forEach=s}};for(var l in a)a[l]&&c(r[l]&&r[l].prototype);c(i)},"17c2":function(e,t,n){"use strict";var r=n("b727").forEach,a=n("a640"),i=a("forEach");e.exports=i?[].forEach:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}},"408a":function(e,t){var n=1..valueOf;e.exports=function(e){return n.call(e)}},"4e82":function(e,t,n){"use strict";var r=n("23e7"),a=n("59ed"),i=n("7b0b"),s=n("07fa"),o=n("577e"),c=n("d039"),l=n("addb"),u=n("a640"),d=n("04d1"),f=n("d998"),g=n("2d00"),p=n("512ce"),m=[],h=m.sort,v=c((function(){m.sort(void 0)})),b=c((function(){m.sort(null)})),x=u("sort"),w=!c((function(){if(g)return g<70;if(!(d&&d>3)){if(f)return!0;if(p)return p<603;var e,t,n,r,a="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)m.push({k:t+r,v:n})}for(m.sort((function(e,t){return t.v-e.v})),r=0;r<m.length;r++)t=m[r].k.charAt(0),a.charAt(a.length-1)!==t&&(a+=t);return"DGBEFHACIJK"!==a}})),I=v||!b||!x||!w,y=function(e){return function(t,n){return void 0===n?-1:void 0===t?1:void 0!==e?+e(t,n)||0:o(t)>o(n)?1:-1}};r({target:"Array",proto:!0,forced:I},{sort:function(e){void 0!==e&&a(e);var t=i(this);if(w)return void 0===e?h.call(t):h.call(t,e);var n,r,o=[],c=s(t);for(r=0;r<c;r++)r in t&&o.push(t[r]);o=l(o,y(e)),n=o.length,r=0;while(r<n)t[r]=o[r++];while(r<c)delete t[r++];return t}})},"512ce":function(e,t,n){var r=n("342f"),a=r.match(/AppleWebKit\/(\d+)\./);e.exports=!!a&&+a[1]},"7ba5":function(e,t,n){},8418:function(e,t,n){"use strict";var r=n("a04b"),a=n("9bf2"),i=n("5c6c");e.exports=function(e,t,n){var s=r(t);s in e?a.f(e,s,i(0,n)):e[s]=n}},"91bf":function(e,t,n){"use strict";n("7ba5")},a434:function(e,t,n){"use strict";var r=n("23e7"),a=n("23cb"),i=n("5926"),s=n("07fa"),o=n("7b0b"),c=n("65f0"),l=n("8418"),u=n("1dde"),d=u("splice"),f=Math.max,g=Math.min,p=9007199254740991,m="Maximum allowed length exceeded";r({target:"Array",proto:!0,forced:!d},{splice:function(e,t){var n,r,u,d,h,v,b=o(this),x=s(b),w=a(e,x),I=arguments.length;if(0===I?n=r=0:1===I?(n=0,r=x-w):(n=I-2,r=g(f(i(t),0),x-w)),x+n-r>p)throw TypeError(m);for(u=c(b,r),d=0;d<r;d++)h=w+d,h in b&&l(u,d,b[h]);if(u.length=r,n<r){for(d=w;d<x-r;d++)h=d+r,v=d+n,h in b?b[v]=b[h]:delete b[v];for(d=x;d>x-r+n;d--)delete b[d-1]}else if(n>r)for(d=x-r;d>w;d--)h=d+r-1,v=d+n-1,h in b?b[v]=b[h]:delete b[v];for(d=0;d<n;d++)b[d+w]=arguments[d+2];return b.length=x-r+n,u}})},a640:function(e,t,n){"use strict";var r=n("d039");e.exports=function(e,t){var n=[][e];return!!n&&r((function(){n.call(null,t||function(){throw 1},1)}))}},a9e3:function(e,t,n){"use strict";var r=n("83ab"),a=n("da84"),i=n("94ca"),s=n("6eeb"),o=n("1a2d"),c=n("7156"),l=n("d9b5"),u=n("c04e"),d=n("d039"),f=n("241c").f,g=n("06cf").f,p=n("9bf2").f,m=n("408a"),h=n("58a8").trim,v="Number",b=a[v],x=b.prototype,w=function(e){var t=u(e,"number");return"bigint"===typeof t?t:I(t)},I=function(e){var t,n,r,a,i,s,o,c,d=u(e,"number");if(l(d))throw TypeError("Cannot convert a Symbol value to a number");if("string"==typeof d&&d.length>2)if(d=h(d),t=d.charCodeAt(0),43===t||45===t){if(n=d.charCodeAt(2),88===n||120===n)return NaN}else if(48===t){switch(d.charCodeAt(1)){case 66:case 98:r=2,a=49;break;case 79:case 111:r=8,a=55;break;default:return+d}for(i=d.slice(2),s=i.length,o=0;o<s;o++)if(c=i.charCodeAt(o),c<48||c>a)return NaN;return parseInt(i,r)}return+d};if(i(v,!b(" 0o1")||!b("0b1")||b("+0x1"))){for(var y,C=function(e){var t=arguments.length<1?0:b(w(e)),n=this;return n instanceof C&&d((function(){m(n)}))?c(Object(t),n,C):t},k=r?f(b):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),E=0;k.length>E;E++)o(b,y=k[E])&&!o(C,y)&&p(C,y,g(b,y));C.prototype=x,x.constructor=C,s(a,v,C)}},addb:function(e,t){var n=Math.floor,r=function(e,t){var s=e.length,o=n(s/2);return s<8?a(e,t):i(r(e.slice(0,o),t),r(e.slice(o),t),t)},a=function(e,t){var n,r,a=e.length,i=1;while(i<a){r=i,n=e[i];while(r&&t(e[r-1],n)>0)e[r]=e[--r];r!==i++&&(e[r]=n)}return e},i=function(e,t,n){var r=e.length,a=t.length,i=0,s=0,o=[];while(i<r||s<a)i<r&&s<a?o.push(n(e[i],t[s])<=0?e[i++]:t[s++]):o.push(i<r?e[i++]:t[s++]);return o};e.exports=r},c6a6:function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-card",{attrs:{shadow:"always"}},[n("div",{staticClass:"horiz-container vertical-center",attrs:{slot:"header"},slot:"header"},[n("span",{staticClass:"header-text"},[e._v("论坛版块管理")]),n("el-divider",{staticClass:"header-text",attrs:{direction:"vertical"}}),n("el-button",{attrs:{type:"danger",disabled:e.selected.length<=0},on:{click:e.deleteSelected}},[e._v("批量删除")]),n("el-button",{attrs:{type:"primary",disabled:e.selected.length<=0},on:{click:e.resetSelectedLevel}},[e._v("重置选中的排序值")]),n("div",{staticClass:"spacer"}),n("el-button",{attrs:{size:"medium",type:"success"},on:{click:function(t){e.dialog=!0}}},[n("i",{staticClass:"fa fa-plus"}),e._v(" 添加新版块 ")])],1),n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.categories,stripe:"",border:""},on:{"selection-change":e.mutilSelectionChange}},[n("el-table-column",{attrs:{type:"selection",width:"35",align:"center"}}),n("el-table-column",{attrs:{prop:"title",label:"标题"}}),n("el-table-column",{attrs:{prop:"description",label:"描述"}}),n("el-table-column",{attrs:{prop:"topicCount",label:"话题数量",width:"85"}}),n("el-table-column",{attrs:{prop:"level",label:"排序值",width:"80"}}),n("el-table-column",{attrs:{label:"最后修改",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(t.row.lastEditor.username))]),n("br"),n("span",[e._v(e._s(e._f("datetimeFormat")(t.row.updatedAt)))])]}}])}),n("el-table-column",{attrs:{label:"操作",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{type:"text",size:"medium",title:"编辑"},on:{click:function(n){return e.editItem(t.row)}}},[n("i",{staticClass:"fa fa-pencil-square-o fa-lg",staticStyle:{color:"blue"}})]),n("el-button",{attrs:{size:"medium",type:"text",title:"删除"},on:{click:function(n){return e.deleteItem(t.row)}}},[n("i",{staticClass:"fa fa-trash-o fa-lg",staticStyle:{color:"red"}})])]}}])})],1),n("el-pagination",{attrs:{background:"",layout:"total, sizes, prev, pager, next, jumper",total:e.totalCount,"page-sizes":[5,10,20,30],"page-size":e.pageSize,"current-page":e.currentPage},on:{"size-change":e.pageSizeChange,"current-change":e.currnetPageChange,"update:pageSize":function(t){e.pageSize=t},"update:page-size":function(t){e.pageSize=t},"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t}}})],1),n("el-dialog",{attrs:{visible:e.dialog,width:"80%","close-on-click-modal":!1,fullscreen:e.fullscreen},on:{"update:visible":function(t){e.dialog=t}}},[n("span",{attrs:{slot:"title"},slot:"title"},[e.fullscreen?n("el-button",{attrs:{type:"text"},on:{click:function(t){e.fullscreen=!1}}},[n("i",{staticClass:"fa fa-clone",staticStyle:{"font-size":"20px"},attrs:{title:"还原"}})]):n("el-button",{attrs:{type:"text"},on:{click:function(t){e.fullscreen=!0}}},[n("i",{staticClass:"fa fa-square-o",staticStyle:{"font-size":"20px"},attrs:{title:"最大化"}})]),n("span",{staticClass:"dialog-title"},[e._v(e._s(e.formTitle))])],1),n("el-card",{attrs:{shadow:"always"}},[n("el-form",{attrs:{"label-position":"top"}},[n("el-row",{attrs:{gutter:20}},[-1!==e.editedIndex?n("el-col",{attrs:{md:24-e.formCols,sm:24}},[n("el-form-item",{attrs:{label:"Level"}},[n("el-input",{attrs:{type:"number","controls-position":"right",max:1e3,label:"Level"},model:{value:e.editedItem.level,callback:function(t){e.$set(e.editedItem,"level",t)},expression:"editedItem.level"}})],1)],1):e._e(),n("el-col",{attrs:{md:e.formCols,sm:24}},[n("el-form-item",{attrs:{label:"标题"}},[n("el-input",{attrs:{placeholder:"标题",maxlength:"50","show-word-limit":""},model:{value:e.editedItem.title,callback:function(t){e.$set(e.editedItem,"title",t)},expression:"editedItem.title"}})],1)],1)],1),n("el-form-item",{attrs:{label:"描述(支持 Markdown 语法)"}},[n("el-input",{attrs:{type:"textarea",rows:e.row,placeholder:"版块描述"},model:{value:e.editedItem.description,callback:function(t){e.$set(e.editedItem,"description",t)},expression:"editedItem.description"}})],1)],1)],1),n("span",{attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"danger"},on:{click:function(t){e.dialog=!1}}},[e._v("取消")]),n("el-button",{attrs:{type:"primary"},on:{click:e.saveItem}},[e._v("保存")])],1)],1)],1)},a=[],i=n("1da1"),s=(n("96cf"),n("d81d"),n("498a"),n("a4d3"),n("e01a"),n("a9e3"),n("4e82"),n("a434"),n("159b"),n("89d5")),o=n("c1df"),c=n.n(o),l={name:"CategoryManager",data:function(){return{categories:[],totalCount:0,pageSize:10,currentPage:1,dialog:!1,fullscreen:!1,loading:!1,selected:[],editedIndex:-1,editedItem:{title:"",description:"",level:0},defaultItem:{title:"",description:"",level:0}}},mounted:function(){this.getCategories()},methods:{getCategories:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,e.categories=[],n=e.pageSize*(e.currentPage-1),t.next=5,s["a"].getTotalCount();case 5:return e.totalCount=t.sent,t.next=8,s["a"].fetchAll(e.pageSize,n,["createdBy","lastEditor"],["-level","-createdAt"]);case 8:r=t.sent,console.log("result: ",r),e.categories=r.map((function(t){return e.formJson(t)})),e.loading=!1;case 12:case"end":return t.stop()}}),t)})))()},editItem:function(e){this.editedIndex=this.categories.indexOf(e),this.editedItem=Object.assign({},e),this.dialog=!0},saveItem:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n,r,a,i,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(console.log("this.editedIndex:",e.editedIndex),-1!==e.editedIndex){t.next=29;break}return t.t0=e.editedItem.title.trim(),t.t1=e.editedItem.description,t.next=6,s["a"].currentUser();case 6:return t.t2=t.sent,t.next=9,s["a"].currentUser();case 9:if(t.t3=t.sent,n={title:t.t0,description:t.t1,level:0,topicCount:0,createdBy:t.t2,lastEditor:t.t3},!n.title){t.next=26;break}return t.next=14,s["a"].existsFieldValue("title",n.title);case 14:if(r=t.sent,!r){t.next=19;break}e.$message({message:'"'.concat(n.title,'" 版块已经存在，不能重复添加'),type:"error"}),t.next=24;break;case 19:return t.next=21,s["a"].create(n);case 21:a=t.sent,console.log("response:",a),a&&(e.categories.push(e.formJson(a)),e.editedItem=Object.assign({},e.defaultItem),e.dialog=!1,e.$notify.success({title:"添加成功",message:"已经成功添加论坛版块: ".concat(n.title),showClose:!1}));case 24:t.next=27;break;case 26:e.$message({message:"版块标题不能为空",type:"warning"});case 27:t.next=43;break;case 29:return i=Object.assign(e.categories[e.editedIndex],e.editedItem),t.t4=s["a"],t.t5=i.id,t.t6=i.title,t.t7=i.description,t.t8=Number(i.level),t.next=37,s["a"].currentUser();case 37:return t.t9=t.sent,t.t10={title:t.t6,description:t.t7,level:t.t8,lastEditor:t.t9},t.next=41,t.t4.update.call(t.t4,t.t5,t.t10);case 41:o=t.sent,o?(e.categories[e.editedIndex].updatedAt=o.updatedAt,e.categories.sort((function(e,t){return t.level-e.level})),e.dialog=!1,e.$message({message:"论坛版块编辑成功",type:"success"})):e.$message({message:"出现错误, 无法完成论坛版块修改",type:"error"});case 43:case"end":return t.stop()}}),t)})))()},deleteItem:function(e){var t=this;this.editedIndex=this.categories.indexOf(e),this.editedItem=Object.assign({},e),this.$confirm('确定要删除名为："'.concat(e.title,'" 的版块吗？'),"删除版块",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(i["a"])(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,s["a"].delete(e.id);case 2:r=n.sent,r&&(t.categories.splice(t.editedIndex,1)[0],t.$message({type:"success",message:"删除成功!"}));case 4:case"end":return n.stop()}}),n)})))).catch((function(){t.$message({type:"info",message:"已取消删除"})}))},mutilSelectionChange:function(e){this.selected=e,console.log(this.selected)},deleteSelected:function(){var e=this;this.$confirm("确定要删除已选中的 ".concat(this.selected.length," 个版块吗？"),"批量删除版块",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(i["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,s["a"].deleteBatch(e.selected);case 2:n=t.sent,n&&(e.getCategories(),e.selected=[],e.$message({type:"success",message:"删除成功!"}));case 4:case"end":return t.stop()}}),t)})))).catch((function(){e.$message({type:"info",message:"已取消删除"})}))},resetSelectedLevel:function(){var e=this;this.$confirm("确定要将已选中的 ".concat(this.selected.length," 个版块的 Level 值重置为 0 吗？"),"重置Level值",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(i["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.selected.forEach(function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("item: ",t),t.level=0,delete t.createdAt,delete t.updatedAt,delete t.createdBy,e.next=7,s["a"].currentUser();case 7:return t.lastEditor=e.sent,e.abrupt("return",t);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),t.next=3,s["a"].updateBatch(e.selected);case 3:n=t.sent,n&&(e.getCategories(),e.selected=[],e.$message({type:"success",message:"重置成功!"}));case 5:case"end":return t.stop()}}),t)})))).catch((function(t){console.log("出现异常:",t),e.$message({type:"info",message:"已取消重置操作"})}))},closeDialog:function(){var e=this;this.dialog=!1,this.fullscreen=!1,this.$nextTick((function(){e.editedItem=Object.assign({},e.defaultItem),e.editedIndex=-1}))},pageSizeChange:function(e){this.getCategories()},currnetPageChange:function(e){this.getCategories()},getUser:function(e){return{id:e.id,username:e.get("username"),email:e.get("email")}},formJson:function(e){return{id:e.id,title:e.get("title"),description:e.get("description"),level:e.get("level"),topicCount:e.get("topicCount"),createdAt:e.createdAt,updatedAt:e.updatedAt,createdBy:e.get("createdBy")?this.getUser(e.get("createdBy")):"",lastEditor:e.get("lastEditor")?this.getUser(e.get("lastEditor")):""}}},computed:{formTitle:function(){return-1===this.editedIndex?"添加新版块":"版块编辑"},formCols:function(){return-1===this.editedIndex?24:21},row:function(){return this.fullscreen?15:5}},filters:{datetimeFormat:function(e){return c()(e).format("lll")}},watch:{dialog:function(e){e||this.closeDialog()}}},u=l,d=(n("91bf"),n("2877")),f=Object(d["a"])(u,r,a,!1,null,null,null);t["default"]=f.exports},d998:function(e,t,n){var r=n("342f");e.exports=/MSIE|Trident/.test(r)}}]);
//# sourceMappingURL=chunk-7bee715a.57535a59.js.map